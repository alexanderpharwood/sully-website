!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";window.document||r("Sully requires a window with a document");var l={};function r(e){throw l.domContainer.innerHTML='<h3 id="exceptionMessage">'+l.exceptionMessage+"</h3>",new Error(e)}function n(e){return(l.basePath+e).replace("//","/")}function c(){var e=window.location.href;return-1===e.indexOf("/?")?void 0:""===(e=e.substr(e.indexOf("/?")+1,e.length))?void 0:e}function i(){var e=!1,o={};for(var r in o.route=function(){if("HASH"===l.routingMethod)e=window.location.hash.substr(1,window.location.hash.length);else var e=window.location.pathname.replace(l.basePath,"");return""===e&&(e=void 0),e}(),o.requestData={},void 0!==o.route&&""!==o.route||(o.route="/"),l.routeProvider){var t=l.routeProvider[r].route,n=t.match(/{(.*?)}/g),i=new RegExp("^"+t.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"$","g");if(null!=o.route.match(i)){var d=i.exec(o.route);o.controller=l.routeProvider[r].controller,o.method=l.routeProvider[r].method,o.middleware=l.routeProvider[r].middleware,o.route=r,e=!0}if(e)break}if(e){var a=1;for(var r in n){var u=n[r].substr(1,n[r].length-2);o.requestData[u]=d[a],a++}}else o.controller=l.notFoundRoute.controller,o.method=l.notFoundRoute.method,o.middleware=l.notFoundRoute.middleware;void 0!==c()&&(o.requestData.queryData=function(){var e=c();if(void 0!==e)return e.split("&").reduce(function(e,o){var r=o.split("=");return e[r[0]]=r[1],e},{})}()),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)l.middlewareProvider[e.middleware[o]].run(e.requestData);void 0!==l.controllerProvider[e.controller].constructor&&l.controllerProvider[e.controller].constructor(e.requestData),l.controllerProvider[e.controller][e.method](e.requestData)}(o)}return l.production=!0,l.version="1.0.0",l.domContainer={},l.controllerProvider={},l.middlewareProvider={},l.viewProvider={},l.routeProvider={},l.notFoundRoute={},l.exceptionMessage="Oops! An error occured processing your request.",l.routeTo=function(e){var o=e.route+(void 0!==e.queryData?"/?"+e.queryData:"");"HISTORY"===l.routingMethod?window.history.pushState({},null,n(e.route)):window.location.hash=o,i()},l.registerNotFound=function(e,o){l.notFoundRoute.controller=e,l.notFoundRoute.method=o},l.registerView=function(e,o){l.viewProvider[e]=o},l.registerRoute=function(e){l.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},l.registerController=function(e,o){l.controllerProvider[e]=o},l.registerMiddleware=function(e,o){l.middlewareProvider[e]=o},l.getViewTemplate=function(e){return l.viewProvider[e]},l.renderView=function(e){void 0===e.template&&r("ERROR: view not found: "+e.view);var o=function e(o,r){var t=(o=o.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var n in t){t[n]=t[n].substr(2,t[n].length-4),t[n].trim();var i=t[n].split(":",1)[0];switch(i){case"view":var d=l.viewProvider[t[n].substr(i.length+1,t[n].length)];o=o.replace("{{"+t[n]+"}}",e(d,r))}}return o}(e.template,void 0===e.data?{}:e.data);l.domContainer.innerHTML=o,e.viewDidLoad(),(void 0===e.scrollToTop||e.scrollToTop)&&(document.body.scrollTop=document.documentElement.scrollTop=0)},l.init=function(e){l.production||console.log("Sully.js, development version "+l.version),l.basePath=e.basePath,l.routingMethod=e.routingMethod,l.interceptAnchorWithClass=e.interceptAnchorWithClass,l.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(l.exceptionMessage=e.exceptionMessage),"HISTORY"===l.routingMethod?window.history&&history.pushState?(window.onpopstate=function(e){i()},window.history.replaceState({},null,window.location.path)):r("Browser does not support routing method."):window.onhashchange=function(){i()},document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var r in o)if("A"===o[r].nodeName&&(void 0===l.interceptAnchorWithClass||o[r].classList.contains(l.interceptAnchorWithClass))){e.preventDefault();var t=o[r].getAttribute("href");return window.history.pushState({},null,n(t)),i(),!0}}),i()},l});